# SUUMO反響データ自動取得 設定手順書

## 1. 概要
毎朝9時にSUUMO管理画面から新着の反響データ（問い合わせ）を自動取得し、Excelファイルに追記保存する自動化処理です。

## 2. 事前準備

### 2.1 必要な環境
- Robo-Pat DX
- Google Chrome ブラウザ
- SUUMO業務支援サイトのアカウント
- C:/RoboPatフォルダへの書き込み権限
- インターネット接続環境

### 2.2 対象システムの設定
- SUUMOのログイン情報を環境変数に設定
- 出力先フォルダ `C:/RoboPat/` の作成
- 初回実行前に `反響データ.xlsx` ファイルの準備（ヘッダー行を含む）

## 3. 変数の設定

| 変数名 | 説明 | 設定値の例 |
|--------|------|-----------|
| login_id | SUUMOログインID（環境変数から取得） | （実行時に自動取得） |
| login_password | SUUMOログインパスワード（環境変数から取得） | （実行時に自動取得） |
| today_date | 実行日の日付（YYYY-MM-DD形式） | 2024-01-15 |
| inquiry_data_json | 取得した反響データ（JSON文字列） | {"date":"2024-01-15","name":"田中太郎"...} |
| inquiry_count | 取得した反響データの件数 | 5 |
| save_result | Excel保存処理の結果メッセージ | "3件のデータを追加しました" |

## 4. スクリプトの実行手順

### 4.1 初回実行前の確認事項
- [ ] 環境変数 `SUUMO_USER_ID` にログインIDが設定済み
- [ ] 環境変数 `SUUMO_PASSWORD` にパスワードが設定済み
- [ ] `C:/RoboPat/` フォルダが存在する
- [ ] `C:/RoboPat/反響データ.xlsx` ファイルが存在し、ヘッダー行（日付,氏名,電話番号,メールアドレス,物件名,備考）が設定済み
- [ ] SUUMOアカウントが有効でログイン可能
- [ ] Google Chromeが最新バージョンに更新済み

### 4.2 実行方法
1. Robo-Pat DXを起動
2. プロジェクト「SUUMO反響データ自動取得」を開く
3. スケジュール実行の場合：毎日9:00に実行されるよう設定
4. 手動実行の場合：「実行」ボタンをクリック

#### 実行プロセス詳細：
1. **初期設定・ログイン**
   - 環境変数からログイン情報を取得
   - SUUMO業務支援サイトにアクセス
   - ログイン実行

2. **反響データ取得**
   - 反響・問い合わせ管理画面に遷移
   - 当日日付で検索条件を設定
   - 新着反響データを検索・取得

3. **データ抽出とExcel保存**
   - 取得したデータをJSON形式で抽出
   - 既存のExcelファイルに追記
   - ファイル保存

4. **終了処理**
   - ブラウザ終了
   - 完了通知（オプション）

## 5. トラブルシューティング

### よくある問題と対処法
| 症状 | 原因 | 対処法 |
|------|------|--------|
| ログインに失敗する | 環境変数が未設定または間違い | 環境変数 `SUUMO_USER_ID`, `SUUMO_PASSWORD` を確認・再設定 |
| Excelファイルが見つからない | ファイルパスが存在しない | `C:/RoboPat/反響データ.xlsx` ファイルを手動作成（ヘッダー行含む） |
| 画面要素が見つからない | SUUMO画面の仕様変更 | セレクタを実際の画面構成に合わせて修正 |
| データが取得できない | 反響データテーブルの構造変更 | データ抽出スクリプトを画面構造に合わせて調整 |
| ブラウザが起動しない | Chrome未インストール・古いバージョン | Google Chromeの最新版をインストール |
| 権限エラーでファイル保存失敗 | フォルダ・ファイルへの書き込み権限なし | C:/RoboPatフォルダとファイルの権限を確認・修正 |

## 6. 注意事項
- SUUMOの画面構成が変更された場合、セレクタの調整が必要
- 大量のデータがある場合、処理時間が長くなる可能性
- ネットワーク環境が不安定な場合はタイムアウトエラーが発生する可能性
- Excelファイルが他のアプリケーションで開かれている場合は保存に失敗
- 定期実行の場合は、PCの電源がオンでRobo-Pat DXが起動している必要
- ログイン情報は定期的に更新し、セキュリティを保持

## 7. 更新履歴
| 日付 | 内容 |
|------|------|
| 2024-01-15 | 初版作成 |