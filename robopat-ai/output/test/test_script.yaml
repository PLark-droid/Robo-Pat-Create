project:
  name: SUUMO反響データ自動取得
  description: '

    毎朝9時に、SUUMOの管理画面にログインして、

    新着の反響データ（問い合わせ）を取得し、

    Excelファイルに追記保存する。


    対象システム: SUUMO 業務支援サイト

    ログイン情報: 環境変数から取得

    出力先: C:/RoboPat/反響データ.xlsx

    '
variables:
- name: login_id
  type: STRING
  default: ''
- name: login_password
  type: STRING
  default: ''
- name: today_date
  type: STRING
  default: ''
- name: inquiry_data_json
  type: STRING
  default: '[]'
- name: inquiry_count
  type: STRING
  default: '0'
- name: save_result
  type: STRING
  default: ''
steps:
- id: 1
  command: comment
  comment: === 初期設定・ログイン ===
  options:
    text: 環境変数取得、SUUMOサイトへのログイン処理
- id: 2
  command: comment
  comment: 環境変数からログイン情報を取得
  options:
    text: === SUUMO反響データ自動取得処理開始 ===
- id: 3
  command: execute_script
  comment: ログインIDを環境変数から取得
  options:
    script: return process.env.SUUMO_USER_ID || '';
    variable: login_id
- id: 4
  command: execute_script
  comment: パスワードを環境変数から取得
  options:
    script: return process.env.SUUMO_PASSWORD || '';
    variable: login_password
- id: 5
  command: if
  comment: ログイン情報が取得できているかチェック
  options:
    condition: login_id == '' || login_password == ''
- id: 6
  command: script_exit
  comment: ログイン情報が不足している場合は終了
  options:
    status: '1'
    message: 環境変数からログイン情報を取得できませんでした
- id: 7
  command: end_if
  comment: 条件分岐終了
  options: {}
- id: 8
  command: open_chrome
  comment: SUUMO業務支援サイトを開く
  options:
    url: https://suumo.jp/
    profile: default
    headless: false
- id: 9
  command: wait_for_screen_calms
  comment: 画面が安定するまで待機
  options: {}
- id: 10
  command: comment
  comment: === ログイン実行 ===
  options:
    text: SUUMOサイトでのログイン処理
- id: 11
  command: click
  comment: ログインボタンをクリック（実際のセレクタに調整要）
  options:
    selector: a[href*='login']
    selector_type: css
    click_type: single
    wait_timeout: 10
- id: 12
  command: input_text
  comment: ログインIDを入力（実際のセレクタに調整要）
  options:
    selector: input[name='loginId']
    selector_type: css
    text: ${login_id}
    clear_first: true
- id: 13
  command: input_password
  comment: パスワードを入力（実際のセレクタに調整要）
  options:
    selector: input[name='password']
    selector_type: css
    password: ${login_password}
- id: 14
  command: click
  comment: ログイン実行ボタンをクリック（実際のセレクタに調整要）
  options:
    selector: button[type='submit']
    selector_type: css
    click_type: single
    wait_timeout: 15
- id: 15
  command: wait_for_screen_calms
  comment: ログイン完了まで待機
  options: {}
- id: 16
  command: comment
  comment: === 反響データ取得 ===
  options:
    text: 反響データ画面への遷移と新着データの取得
- id: 17
  command: execute_script
  comment: 本日の日付を取得
  options:
    script: return new Date().toISOString().split('T')[0];
    variable: today_date
- id: 18
  command: click
  comment: 反響・問い合わせ管理メニューをクリック（実際のセレクタに調整要）
  options:
    selector: a[href*='inquiry']
    selector_type: css
    click_type: single
    wait_timeout: 10
- id: 19
  command: wait_for_screen_calms
  comment: 反響データ画面の読み込み完了を待機
  options: {}
- id: 20
  command: input_text
  comment: 検索開始日に本日の日付を入力（実際のセレクタに調整要）
  options:
    selector: input[name='fromDate']
    selector_type: css
    text: ${today_date}
    clear_first: true
- id: 21
  command: input_text
  comment: 検索終了日に本日の日付を入力（実際のセレクタに調整要）
  options:
    selector: input[name='toDate']
    selector_type: css
    text: ${today_date}
    clear_first: true
- id: 22
  command: click
  comment: 検索ボタンをクリック（実際のセレクタに調整要）
  options:
    selector: button[type='submit'].search-btn
    selector_type: css
    click_type: single
    wait_timeout: 10
- id: 23
  command: wait_for_screen_calms
  comment: 検索結果の表示完了を待機
  options: {}
- id: 24
  command: comment
  comment: === データ抽出とExcel保存 ===
  options:
    text: 反響データの抽出とExcelファイルへの追記
- id: 25
  command: execute_script
  comment: 反響データテーブルからデータを抽出（実際の構造に調整要）
  options:
    script: 'var rows = document.querySelectorAll(''table.inquiry-table tbody tr'');
      var data = []; for(var i = 0; i < rows.length; i++) { var cells = rows[i].querySelectorAll(''td'');
      if(cells.length > 0) { data.push({ date: cells[0].textContent.trim(), name:
      cells[1].textContent.trim(), phone: cells[2].textContent.trim(), email: cells[3].textContent.trim(),
      property: cells[4].textContent.trim(), comment: cells[5].textContent.trim()
      }); } } return JSON.stringify(data);'
    variable: inquiry_data_json
- id: 26
  command: execute_script
  comment: JSONデータを解析して件数をチェック
  options:
    script: var data = JSON.parse('${inquiry_data_json}' || '[]'); return data.length;
    variable: inquiry_count
- id: 27
  command: if
  comment: 新着データが0件の場合の処理
  options:
    condition: inquiry_count == 0
- id: 28
  command: comment
  comment: 新着反響データなしの場合はメッセージ出力
  options:
    text: 本日の新着反響データはありませんでした
- id: 29
  command: script_exit
  comment: 正常終了
  options:
    status: '0'
    message: 新着反響データなし - 処理正常終了
- id: 30
  command: end_if
  comment: 条件分岐終了
  options: {}
- id: 31
  command: execute_script
  comment: Excelファイル操作用のスクリプト実行（実際のライブラリに調整要）
  options:
    script: 'var XLSX = require(''xlsx''); var fs = require(''fs''); var filePath
      = ''C:/RoboPat/反響データ.xlsx''; var workbook; try { workbook = XLSX.readFile(filePath);
      } catch(e) { workbook = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(workbook,
      XLSX.utils.aoa_to_sheet([[''日付'',''氏名'',''電話番号'',''メールアドレス'',''物件名'',''備考'']]),
      ''反響データ''); } var worksheet = workbook.Sheets[''反響データ'']; var data = JSON.parse(''${inquiry_data_json}'');
      var range = XLSX.utils.decode_range(worksheet[''!ref'']); for(var i = 0; i <
      data.length; i++) { var newRow = range.e.r + 1 + i; XLSX.utils.sheet_add_aoa(worksheet,
      [[data[i].date, data[i].name, data[i].phone, data[i].email, data[i].property,
      data[i].comment]], {origin: ''A'' + (newRow + 1)}); } XLSX.writeFile(workbook,
      filePath); return data.length + ''件のデータを追加しました'';'
    variable: save_result
- id: 32
  command: comment
  comment: 保存結果をログ出力
  options:
    text: 'Excel保存結果: ${save_result}'
- id: 33
  command: comment
  comment: === 終了処理 ===
  options:
    text: ブラウザ終了と完了通知
- id: 34
  command: close_tab
  comment: ブラウザタブを閉じる
  options: {}
- id: 35
  command: send_mail
  comment: 完了通知メール送信（オプション）
  options:
    to: admin@company.com
    subject: SUUMO反響データ取得完了
    body: '本日のSUUMO反響データ取得が完了しました。\n取得件数: ${inquiry_count}件\n保存先: C:/RoboPat/反響データ.xlsx'
- id: 36
  command: script_exit
  comment: 処理正常終了
  options:
    status: '0'
    message: SUUMO反響データ取得処理が正常に完了しました
